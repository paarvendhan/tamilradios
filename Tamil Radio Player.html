
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Tamil Online Radio</title>
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui-bootstrap/0.5pre/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css">
    <link rel="stylesheet" href="https://radio.vstartv.org/audio-player/style.css">
    <link rel="icon" type="image/png" sizes="16x16"  href="https://radio.vstartv.org/uploads/admins/favicondefault.x-icon">
</head>
<body style="background: black;">
<div class="d-flex justify-content-center align-items-center container" style="background: transparent !important;">
    <div id="player" class="align-items-start">
        <div class="container p-0 m-0 w-100">
            <div class="row justify-content-between w-100" id="top-row">
                <div class="col-xs-2" id="left-button">
                    <div class="dropdown keep-open">
                        <button class="btn-floating btn-lg" role="button" id="volume-menu" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false" role="button"><i
                                    class="fas fa-volume-up"></i></button>
                        <div class="dropdown-menu" role="menu" aria-labelledby="volume-menu">
                            <input type="range" min="0" max="50" value="50" id="volume-bar"/>
                        </div>
                    </div>
                </div>
                <div class="col-xs-8 m-auto" id="player-title">Live</div>
                <div class="col-xs-2" id="right-button">
                    <div class="dropdown keep-open">
                        <button class="btn-floating btn-lg" role="button" id="menu" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false" role="button"><i class="fas fa-bars"></i>
                        </button>
                        <div class="dropdown-menu text-left dropdown-menu-channels" role="menu" aria-labelledby="menu">


			<a class="dropdown-item channel-link  running " href="https://radios.crabdance.com:8002/3">HELLO FM </a>
			<a class="dropdown-item channel-link  running " href="https://22243.live.streamtheworld.com/MINNAL_FMAAC.aac">MINNAL FM </a>
			<a class="dropdown-item channel-link  running " href="https://radio.vstartv.org:8691/stream">VAANAM FM </a>
                        <a class="dropdown-item channel-link  running " href="https://s7.yesstreaming.net:9000/stream">VAANAVIL FM </a>
			<a class="dropdown-item channel-link  running " href="https://radio.lotustechnologieslk.net:2020/stream/sooriyanfmgarden">SOORYAN FM </a>
			<a class="dropdown-item channel-link  running " href="https://www.liveradio.es/http://stream.zeno.fm/ihpr0rqzoxquv">AR RAHMAN HITS </a>    
			<a class="dropdown-item channel-link  running " href="https://www.liveradio.es/http://stream.zeno.fm/0i6gq0fixlwvv">ILAIYARAJA HITS </a>  
			<a class="dropdown-item channel-link  running " href="https://ec3.yesstreaming.net:4040/stream">SPB HITS </a>
			<a class="dropdown-item channel-link  running " href="https://stream-163.zeno.fm/ijpae65onobuv?zt=eyJhbGciOiJIUzI1NiJ9.eyJzdHJlYW0iOiJpanBhZTY1b25vYnV2IiwiaG9zdCI6InN0cmVhbS0xNjMuemVuby5mbSIsInJ0dGwiOjUsImp0aSI6IlptOU1ldERjU2JlWXZ1UTBucDR1YmciLCJpYXQiOjE3MTg2ODczMjIsImV4cCI6MTcxODY4NzM4Mn0.Scz0MaHftUqM2A1R1zqRhz9bozoUxoyj1HWjv9Fu2TY">DEVA HITS </a>
			<a class="dropdown-item channel-link  running " href="https://stream-151.zeno.fm/nnhhfe4bv1uuv?zt=eyJhbGciOiJIUzI1NiJ9.eyJzdHJlYW0iOiJubmhoZmU0YnYxdXV2IiwiaG9zdCI6InN0cmVhbS0xNTEuemVuby5mbSIsInJ0dGwiOjUsImp0aSI6IjdIdG5GTEsxUTBlXzB5Z3ViVFhwaUEiLCJpYXQiOjE3MTg2ODczOTIsImV4cCI6MTcxODY4NzQ1Mn0.o4kntzTz62cj9gGsXcWz1yuXA4XGPsy2Rz4Sl8IJo-Y">S JANAKI HITS </a>

                                                    </div>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center align-items-center w-100" id="album">
                <div class="col-xs-12 w-100">
                    <div class="flip-card">
                        <div class="flip-card-inner">
                            <div class="album-border flip-card-front">
                                <img class="online" src="https://i.pinimg.com/originals/be/40/b8/be40b8b5beea51d0f3c4ff2df37e32ae.gif"/>
                                <div class="album-shadow"></div>
                                <div class="visualizer paused">
                                    <div class="circle"></div>
                                    <div class="circle"></div>
                                    <div class="circle"></div>
                                    <div class="circle"></div>
                                    <div class="circle"></div>
                                    <div class="circle"></div>
                                </div>
                            </div>

                            <div class="album-back flip-card-back">
                                <div class="album-border flip-card-front">
                                    <img class="online" src="https://i.pinimg.com/originals/38/02/e9/3802e99a0d90076b5513683debe184b2.gif"/>
                                    <div class="album-shadow"></div>
                                    <div class="visualizer paused">
                                        <div class="circle"></div>
                                        <div class="circle"></div>
                                        <div class="circle"></div>
                                        <div class="circle"></div>
                                        <div class="circle"></div>
                                        <div class="circle"></div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center align-items-center w-100" id="title">
                <div class="col-xs-12" id="track-title"></div>
            </div>
            <div class="row justify-content-center align-items-center w-100" id="artist">
                <div class="col-12 text-center" id="track-album"></div>
                <div class="col-12 text-center" id="track-artist"></div>
                <div class="col-12 text-center">TAMIL RADIOS</div>
            </div>
            <div class="row justify-content-between w-100" id="track">
                <div class="col-xs-1 mr-auto" id="elapsed">0:00</div>
                <div class="col-xs-10">&nbsp;</div>
                <div class="col-xs-1 ml-auto" id="remaining">0:00</div>
            </div>
            <div class="row justify-content-center align-items-center w-100" id="progress">
                <div class="col-xs-12 w-100" style="width: 100% !important;">
                    <input type="range" min="0" max="166" value="0" id="progress-bar"/>
                    <audio controls preload="none" id="song" volume="40" src="https://radios.crabdance.com:8002/1" type="audio/mp3" ></audio>
                </div>
            </div>
            <div class="row justify-content-between w-100" id="controls">
                <div class="col-xs-4">
                    <button class="btn-floating btn-lg backward"><i class="fas fa-backward"></i></button>
                </div>
                <div class="col-xs-4">
                    <button class="btn-floating btn-lg active pauseplay"><i class="fas fa-play"></i></button>
                </div>
                <div class="col-xs-4">
                    <button class="btn-floating btn-lg forward"><i class="fas fa-forward"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jQuery.Marquee/1.5.0/jquery.marquee.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    function tTime(s) {
        s = Math.round(s);
        var h = Math.floor(s / 3600);
        s -= h * 3600;
        var m = Math.floor(s / 60);
        s -= m * 60;
        return (m < 10 ? m : m) + ":" + (s < 10 ? '0' + s : s);
    }

    function diff(a, b) {
        return Math.abs(a - b);
    }

    function currProg(s) {
        var total = $("#progress-bar").prop('max');
        var current = $("#progress-bar").val();
        return ((100 / total) * current);
    }

    function currVol(s) {
        var total = $("#volume-bar").prop('max');
        var current = $("#volume-bar").val();
        return ((100 / total) * current);
    }

    function create_style(css) {
        head = document.head,
            oldstyles = head.querySelector("#rangestyle"),
            style = document.createElement('style');
        if (oldstyles != null) {
            oldstyles.remove();
        }
        style.id = "rangestyle";
        head.appendChild(style);

        style.type = 'text/css';
        if (style.styleSheet) {
            style.styleSheet.cssText = css;
        } else {
            style.appendChild(document.createTextNode(css));
        }
    }

    function create_style2(css2) {
        head2 = document.head,
            oldstyles2 = head2.querySelector("#rangestyle2"),
            style2 = document.createElement('style');
        if (oldstyles2 != null) {
            oldstyles2.remove();
        }
        style2.id = "rangestyle2";
        head2.appendChild(style2);

        style2.type = 'text/css';
        if (style2.styleSheet) {
            style2.styleSheet.cssText = css2;
        } else {
            style2.appendChild(document.createTextNode(css2));
        }
    }

    var audio;
    var playing = false;
    var played = false;
    var lyric = $('#lyrics');

    function loadAudio() {
        audio.trigger('load');
    }

    function toggleAudio() {
        if (!played) {
            lyric = $('#lyrics').marquee({
                duration: 166000,
                gap: 5,
                speed: 4,
                delayBeforeStart: 0,
                direction: 'up',
                duplicated: true,
                startVisible: true
            });
            $(".visualizer").fadeIn();
            played = true;
        }
        if (playing) {
            pauseAudio();
        } else {
            playAudio();
        }
    }

    function playAudio() {
        var clink = $('.running').attr('href');
        let random = Math.random().toString(36).slice(2, 7);
        audio.attr('src',clink+'?tag='+random);

        audio.trigger('play');
        playing = true;
        if ($("button.pauseplay i").hasClass("fa-play"))
            $("button.pauseplay i").toggleClass("fa-play fa-pause");
        lyric.marquee("resume");
        $(".visualizer").fadeIn().toggleClass("paused playing");
    }

    function pauseAudio() {
        audio.trigger('pause');
        playing = false;
        $("button.pauseplay i").toggleClass("fa-pause fa-play").removeClass("active");
        lyric.marquee("pause");
        $(".visualizer").toggleClass("playing paused");
    }

    function stopAudio() {
        audio.trigger('pause');
        $("button.pauseplay i").toggleClass("fa-play fa-pause").removeClass("active");
        audio.prop("currentTime", 0);
        $("lyrics").marquee("pause");
        $("lyrics").marquee("destroy");
        lyric = $('#lyrics').marquee({
            duration: 166000,
            gap: 5,
            delayBeforeStart: 0,
            direction: 'up',
            duplicated: true,
            startVisible: true
        }).marquee("pause");
        $(".visualizer").fadeOut().toggleClass("playing paused");
    }

    function forwardAudio() {
        if (playing) {
            pauseAudio();
            audio.prop("currentTime", audio.prop("currentTime") + 5);
            playAudio();
        } else {
            stopAudio();
            playAudio();
        }
    }

    function backAudio() {
        if (playing) {
            pauseAudio();
            audio.prop("currentTime", audio.prop("currentTime") - 5);
            playAudio();
        } else {
            stopAudio();
            playAudio();
        }
    }

    function volumeUp() {
        var volume = audio.prop("volume") + 0.01;
        if (volume > 1) {
            volume = 1;
        }
        audio.prop("volume", volume);
    }

    function volumeDown() {
        var volume = audio.prop("volume") - 0.01;
        if (volume < 0) {
            volume = 0;
        }
        audio.prop("volume", volume);
    }

    function volumeChange(percent) {
        var volume = $("#volume-bar").val();
        if (volume == 100) {
            volume = 1;
        } else if (volume <= 9) {
            volume = "0.0" + volume;
        } else {
            volume = "0." + volume;
        }
        audio.prop("volume", volume);
    }

    function toggleMuteAudio() {
        audio.prop("muted", !audio.prop("muted"));
    }

    function addEventHandlers() {
        $("button.forward").click(forwardAudio);
        $("button.backward").click(backAudio);
        $("button.pauseplay").click(toggleAudio);
    }

    $(document).ready(function () {

        var seeking = false;

        audio = $("#song");
        addEventHandlers();
        lyric.marquee("pause");

        $("#song").on("timeupdate", function (e) {
            $('#elapsed').html(tTime(document.getElementById("song").currentTime));
            if (!seeking) {
                $("#progress-bar").val(audio.prop("currentTime"));
                //$('#remaining').html(tTime(diff(audio.prop("duration"), audio.prop("currentTime"))));
                $('#remaining').html('Live');
                var val = Math.round(currProg($("#progress-bar").val()));
                if ((val >= 90) && (val <= 99)) val = (val - 1);
                create_style("#progress input[type=range]::-webkit-slider-runnable-track { background: linear-gradient(90deg, rgba(218,80,25,1) 0%, rgba(184,160,34,1) " + val + "%, #1D2021 " + val + "%, #1D2021 100%) !important;}");
                if (navigator.userAgent.indexOf("Firefox") != -1) {
                    create_style("#progress input[type=range]::-moz-range-track { background: linear-gradient(90deg, rgba(218,80,25,1) 0%, rgba(184,160,34,1) " + val + "%, #1D2021 " + val + "%, #1D2021 100%) !important;}");
                }
            }
        });
        $("#song").on("ended", function (e) {
            stopAudio();
        });

        $("#progress-bar").on("mousedown", function (event) {
            seeking = true;
            seek(event);
            pauseAudio();
            lyric.marquee("pause");
        });

        $("#progress-bar").on("mousemove", function (event) {
            seek(event);
        });
        $("#progress-bar").on("mouseup", function () {
            seeking = false;
            audio.prop("currentTime", $("#progress-bar").val());
            playAudio();
            lyric.marquee("resume");
        });

        function seek(event) {
            if (seeking) {
                audio.prop("currentTime", $("#progress-bar").val());
            }
        }

        $(document).on('input', '#progress-bar', function () {
            //$('#remaining').html(tTime(diff(audio.prop("duration"), $("#progress-bar").val())));
            $('#remaining').html('Live');
            var val = Math.round(currProg($(this).val()));
            if (val == 98) val = 97;
            create_style("#progress input[type=range]::-webkit-slider-runnable-track { background: linear-gradient(90deg, rgba(218,80,25,1) 0%, rgba(184,160,34,1) " + val + "%, #1D2021 " + val + "%, #1D2021 100%) !important;}");
            if (navigator.userAgent.indexOf("Firefox") != -1) {
                create_style("#progress input[type=range]::-moz-range-track { background: linear-gradient(90deg, rgba(218,80,25,1) 0%, rgba(184,160,34,1) " + val + "%, #1D2021 " + val + "%, #1D2021 100%) !important;}");
            }
        });
        $(document).on('input', '#volume-bar', function () {
            var val2 = Math.round(currVol($("#volume-bar").val()));
            volumeChange(val2);
            create_style2("#top-row input[type=range]::-webkit-slider-runnable-track { background: linear-gradient(90deg, rgba(218,80,25,1) 0%, rgba(184,160,34,1) " + val2 + "%, #1D2021 " + val2 + "%, #1D2021 100%) !important;}");
            if (navigator.userAgent.indexOf("Firefox") != -1) {
                create_style2("#top-row input[type=range]::-moz-range-track { background: linear-gradient(90deg, rgba(218,80,25,1) 0%, rgba(184,160,34,1) " + val2 + "%, #1D2021 " + val2 + "%, #1D2021 100%) !important;}");
            }
        });

    });


    UpdatePlayer()
    var intervalId = window.setInterval(function () {
        UpdatePlayer()
    }, 5000);

    function UpdatePlayer() {
        var flag = 0
        axios.post('https://radio.vstartv.org' + '/api/player', {
            port: 8691,
        }).then((response) => {
            if (response.data.status === 'success') {
                UpdateMeta(response.data.data.track)
            }
        })
    }

    function UpdateMeta(track) {
        axios.post('https://radio.vstartv.org' + '/api/update-player-meta', {
            track: track,
            port: 8691,
        }).then((response) => {
            if (response.data.status === 'success') {

                // if(response.data.current_track['api_image'] == null || response.data.current_track['api_image'] == ""){
                //     $('.online').attr('src', response.data.current_track['image']);
                // }else{
                //     $('.online').attr('src', response.data.current_track['api_image']);
                // }


                if (response.data.current_track['image'] != null){
                    let lastPart = response.data.current_track.image.split("/").pop();
                    if (lastPart === "track-icon.png") {
                        if( response.data.current_track != null &&  response.data.current_track.api_image != null){
                            $('.online').attr('src', response.data.current_track.api_image);
                        }else{
                            $('.online').attr('src', response.data.current_track.image);
                        }
                    } else {
                        $('.online').attr('src', response.data.current_track.image);
                    }
                }else if(response.data.deezer != null){
                    $('.online').attr('src', response.data.deezer.album['cover_medium']);
                }

                if(response.data.current_track['api_title'] == null || response.data.current_track['api_title'] == ""){
                    $("#track-title").html(response.data.current_track['title']);
                }else{
                    $("#track-title").html(response.data.current_track['api_title']);
                }

                if(response.data.current_track['api_album'] == null || response.data.current_track['api_album'] == ""){
                    $("#track-album").html(response.data.current_track['album']);
                }else{
                    $("#track-album").html(response.data.current_track['api_album']);
                }

                if(response.data.current_track['api_artist'] == null || response.data.current_track['api_artist'] == ""){
                    $("#track-artist").html(response.data.current_track['artist']);
                }else{
                    $("#track-artist").html(response.data.current_track['api_artist']);
                }


            }
            RePlayLink()
        })
    }

    function RePlayLink() {
        console.log('check')
        audio.on("ended", function() {
            console.log('ended')
            var clink = $('.running').attr('href');
            let random = Math.random().toString(36).slice(2, 7);
            audio.attr('src',clink+'?tag='+random);
            audio.trigger('play');
            playing = true;
            if ($("button.pauseplay i").hasClass("fa-play"))
                $("button.pauseplay i").toggleClass("fa-play fa-pause");
            lyric.marquee("resume");
            $(".visualizer").fadeIn().toggleClass("paused playing");
        });
        audio.on("error", function() {
            console.log('error')
            var clink = $('.running').attr('href');
            let random = Math.random().toString(36).slice(2, 7);
            audio.attr('src',clink+'?tag='+random);
            audio.trigger('play');
            playing = true;
            if ($("button.pauseplay i").hasClass("fa-play"))
                $("button.pauseplay i").toggleClass("fa-play fa-pause");
            lyric.marquee("resume");
            $(".visualizer").fadeIn().toggleClass("paused playing");
        });
    }

    $('.channel-link').click(function (e){
        e.preventDefault();
        var thisclass = $(this);
        $('.channel-link').removeClass('running');
        thisclass.addClass('running');
        var link = thisclass.attr('href');
        let random = Math.random().toString(36).slice(2, 7);
        audio.attr('src',link+'?tag='+random);
        stopAudio();
        playAudio();
    });
</script>
</body>
</html>
